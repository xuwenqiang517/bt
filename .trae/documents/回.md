# 回测性能优化方案

## 优化策略

### 1. **数据获取优化（最大收益）**
- 在 `sell()` 方法开始时，预加载当日所有持仓股票数据到缓存字典
- 后续所有数据访问都从缓存字典获取，消除重复调用
- 预期提升：**50-70%**

### 2. **持仓查找优化**
- 用 `set` 存储持仓代码，实现 O(1) 查找
- 预期提升：**5-10%**

### 3. **卖出逻辑优化**
- 遍历持仓时直接标记并删除，避免双重遍历
- 预期提升：**3-5%**

### 4. **缓存优化**
- 持仓天数计算结果缓存到 HoldStock
- 预期提升：**2-3%**

### 5. **预加载优化**
- 在 `execute_one_strategy()` 循环开始前预加载当日数据
- 使用批量数据获取接口

## 预期总体提升：**10倍以上**

## 具体修改文件

- `/Users/wq/Documents/github/bt/controllor/bt.py`